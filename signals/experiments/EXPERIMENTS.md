# SignalPredictor 실험 목차

기술 지표 기반 매매 **신호** 예측기 검증 실험

> **핵심 원칙**: 주식 가격은 예측 불가능하다. 시그널을 찾는 것이 주 기능이고, 예측은 참고치일 뿐이다.

## 실험 목록

| ID | 실험명 | 목적 | 상태 |
|----|--------|------|------|
| E001 | 단일 지표 신호 정확도 | 개별 지표별 신호 정확도 측정 | **완료** |
| E002 | 복합 지표 컨센서스 | 다중 지표 조합 효과 검증 | **완료** |
| E003 | 예측 통합 효과 | forecast 전략 추가 효과 검증 | **완료** |
| E004 | 시장 레짐별 신호 성능 | 상승/하락/횡보장 구분 성능 | **완료** |
| E005 | 신호 강도와 수익률 상관관계 | strength 값의 유효성 검증 | **완료** |
| E006 | 실제 주가 데이터 백테스트 | 한국 주식 실데이터 검증 | **완료** |
| E007 | 확장 종목 백테스트 | 25개 종목 Buy&Hold 초과 탐색 | **완료** |
| E008 | 적응형 전략 검증 | AdaptiveSignalPredictor 효과 측정 | **완료** |

---

## 핵심 결과 요약

### E001 결과: 단일 지표 신호 정확도
| 지표 | 신호수 | 정확도 | 손익비 |
|------|--------|--------|--------|
| SMA(10/30) | 18 | **61.1%** | 0.88 |
| ADX | 219 | 54.3% | **2.01** |
| MACD | 27 | 55.6% | 1.03 |

**핵심**: 추세 추종 > 평균회귀

### E002 결과: 복합 지표 컨센서스
| 전략 | 신호수 | 정확도 | 손익비 |
|------|--------|--------|--------|
| trend+momentum@60% | 30 | 70.0% | **8.73** |
| all@50% | 18 | **77.8%** | 7.86 |

**핵심**: 높은 컨센서스 = 적은 신호 but 높은 품질

### E003 결과: 예측 통합 효과
| 시나리오 | 제외 수익 | 포함 수익 | 개선 | 효과 |
|----------|-----------|-----------|------|------|
| uptrend | 21.2% | 16.4% | -4.8% | ✗ |
| downtrend | -4.1% | -2.1% | +2.0% | ✓ |
| sideways | -1.0% | +1.6% | +2.6% | ✓ |
| volatile | -2.8% | -28.2% | -25.3% | ✗ |
| mixed | 5.6% | -1.6% | -7.2% | ✗ |

**핵심**: 예측은 참고치일 뿐, 신호 자체가 중요
- 평균 개선: -6.54% (forecast가 오히려 악화)
- 하락장/횡보장에서만 약간 도움
- **권장**: forecast 전략은 기본 비활성화, 특수 상황에서만 참고

### E004 결과: 시장 레짐별 신호 성능
| 레짐 | 최적 전략 | 손익비 | 정확도 |
|------|-----------|--------|--------|
| 상승장 | trend | **4.01** | 71.4% |
| 하락장 | meanReversion | 1.51 | 49.2% |
| 횡보장 | trend+momentum | 1.64 | 59.5% |
| 고변동장 | all | **5.77** | 72.2% |

**핵심 발견**:
- 상승장: trend 전략 압도적 (가설 확인 ✓)
- 하락장: meanReversion > momentum (가설 기각)
- 횡보장: trend+momentum 조합 최적 (가설 기각)
- 고변동장: 전체 전략 조합(all)이 최적

**권장 전략 매핑**:
- 상승장 감지 → `['trend']`
- 하락장 감지 → `['meanReversion']`
- 횡보장 감지 → `['trend', 'momentum']`
- 고변동장 감지 → `None` (전체)

### E005 결과: 신호 강도와 수익률 상관관계
| Strength 구간 | 신호수 | 평균수익 | 승률 |
|---------------|--------|----------|------|
| 0.5 - 0.6 | 26 | -0.08% | 50.0% |
| 0.6 - 0.7 | 75 | 0.10% | 49.3% |
| 0.7 - 0.8 | 107 | **0.76%** | 53.3% |
| 0.8 - 1.0 | 104 | -0.15% | 49.0% |

**핵심 발견**:
- Pearson 상관계수: -0.08 (p=0.17) → 통계적 유의성 없음
- 그러나 strength ≥ 0.6 필터링 시 +0.34% 개선
- 최적 구간: 0.7 - 0.8 (평균수익 0.76%, 승률 53.3%)

**권장**: strength 0.6 이상 필터링 적용

### E006 결과: 실제 주가 데이터 백테스트
테스트 기간: 2023-01-01 ~ 2024-12-31 (2년)

| 전략 | 평균 vs B&H | B&H 초과 | 평균 승률 |
|------|-------------|----------|-----------|
| trend+momentum@50% | -27.8% | 2/5 | 51.3% |
| trend@50% | -22.0% | 1/5 | 43.2% |
| all@40% | **-15.4%** | **3/5** | **67.8%** |

**종목별 특이사항**:
- 삼성전자: 모든 전략에서 B&H 초과 (하락장에서 유효)
- SK하이닉스: 129.7% 급등으로 모든 전략 패배
- 카카오: all@40%에서 +50.1% 초과 (하락장 방어)

**핵심 결론**:
> **주식은 예측 불가능** - 시그널은 참고용
- 평균적으로 Buy&Hold 초과 실패
- 단, 하락장/횡보장에서는 신호 전략이 방어적으로 유효
- 급등장(SK하이닉스)에서는 신호가 오히려 기회 상실

### E007 결과: 확장 종목 백테스트 (25개 종목, 3년)
테스트 기간: 2022-01-01 ~ 2024-12-31

**카테고리별 B&H 초과 성공률**:
| 카테고리 | 성공률 | 평균 vs B&H |
|----------|--------|-------------|
| ETF | **77.1%** | +16.6% |
| KOSDAQ | **74.3%** | +24.2% |
| KOSPI | **67.1%** | +12.6% |
| US | 17.1% | -52.0% |

**전략별 성공률**:
| 전략 | 성공률 |
|------|--------|
| trend+momentum | **68.0%** |
| trend / all@50% / all@40% | 64.0% |
| momentum | 56.0% |
| meanReversion | 48.0% |

**핵심 발견** (중요!):
> **종목별 최적 전략 사용 시 76% (19/25)에서 B&H 초과!**

- 한국 주식/ETF: 대부분 B&H 초과 가능
- 미국 주식: NVIDIA 제외하고 대부분 실패 (급등장 특성)
- **하락장 종목에서 특히 유효**: 카카오(+72.6%), 삼성SDI(+67.9%)
- **급등장에서는 실패**: NVIDIA(-135.1%)

**10% 이상 B&H 초과 종목 (19개)**:
- 에코프로(+189%), 에코프로비엠(+169%), Tesla(+132%), F&F(+132%)
- 포스코퓨처엠(+116%), 카카오(+73%), 삼성SDI(+68%)

**결론 수정**:
> 주식 "가격"은 예측 불가능하지만, **"방향성 시그널"은 유효할 수 있다**
> 특히 하락장/횡보장에서 방어적 시그널 전략이 효과적

### E008 결과: 적응형 전략 검증
테스트 기간: 2022-01-01 ~ 2024-12-31 (9개 종목)

| 지표 | 적응형 | 고정(trend+momentum) |
|------|--------|----------------------|
| B&H 초과 종목 | 6/9 (66.7%) | **8/9 (88.9%)** |
| 평균 vs B&H | +9.4% | **+41.1%** |

**레짐 감지 분포**:
- 하락장: 31.1%
- 고변동장: 30.8%
- 횡보장: 15.6%
- 상승장: 14.3%
- 강한상승장: 8.2%

**핵심 발견** (중요!):
> **적응형 전략이 고정 전략보다 -31.7% 부진**

원인 분석:
1. **레짐 감지 지연(lag)**: 레짐 전환 시점에서 이미 늦음
2. **빈번한 전략 전환**: 과도한 전환으로 일관성 저하
3. **하락장/고변동장 과다 감지**: 61.9%가 부정적 레짐

**결론**:
> **고정 전략(trend+momentum)이 더 안정적**
> 적응형 전략은 "레짐 감지 지연" 문제로 오히려 성능 저하
> 단순함이 복잡함을 이긴다

**권장**:
- 기본: `['trend', 'momentum']` 고정 사용
- 적응형은 장기 레짐 전환 시에만 참고용

---

## E001: 단일 지표 신호 정확도

### 목적
- 각 기술 지표가 생성하는 신호의 정확도 측정
- 어떤 지표가 가장 신뢰할 수 있는지 파악

### 방법
1. RSI, MACD, 볼린저, 이평선 등 개별 지표 신호 생성
2. 신호 발생 후 N일 수익률 측정 (N = 5, 10, 20일)
3. 정확도 = (수익 신호 / 전체 신호) × 100

### 측정 지표
- 신호 정확도 (%)
- 평균 수익률 (신호 후 N일)
- 승률 (수익 > 0인 비율)
- 손익비 (평균이익 / 평균손실)

---

## E002: 복합 지표 컨센서스

### 목적
- 여러 지표 조합이 단일 지표보다 나은지 검증
- 최적 컨센서스 임계값 탐색 (50%, 60%, 70%)

### 방법
1. 전략 그룹별 조합 테스트
   - 추세 only (SMA, EMA, ADX)
   - 모멘텀 only (RSI, MACD, 스토캐스틱)
   - 전체 조합
2. 컨센서스 비율별 성능 비교

### 가설
- 컨센서스 > 60%일 때 더 정확한 신호
- 전략 그룹 내 조합이 전체 조합보다 나을 수 있음

---

## E003: 예측 통합 효과

### 목적
- forecast 전략(시계열 예측) 추가 시 신호 품질 변화
- 예측은 "참고치"로만 활용, 신호 보조 역할 검증

### 방법
1. forecast 제외 vs 포함 비교
2. 예측 신뢰도별 가중치 조정 효과

### 핵심 원칙
- 예측은 절대 주 신호가 아님
- 기술 지표 신호를 보조하는 참고치

---

## E004: 시장 레짐별 신호 성능

### 목적
- MarketClassifier와 연동하여 시장 상황별 신호 성능 분석
- 어떤 시장에서 어떤 신호가 유효한지 파악

### 방법
1. 데이터를 시장 레짐으로 분류 (상승/하락/횡보/고변동)
2. 각 레짐에서 신호 정확도 측정
3. 레짐별 최적 전략 조합 도출

### 가설
- 상승장: 추세 추종 신호가 유효
- 하락장: 모멘텀 반전 신호가 유효
- 횡보장: 평균회귀 신호가 유효

---

## E005: 신호 강도와 수익률 상관관계

### 목적
- SignalResult.strength 값이 실제 수익률과 상관있는지 검증
- 강한 신호만 사용하는 전략의 유효성 검증

### 방법
1. strength 구간별 그룹화 (0.5-0.6, 0.6-0.7, 0.7-0.8, 0.8+)
2. 각 구간별 평균 수익률 및 승률 측정
3. strength와 수익률 간 상관계수 계산

### 기대 결과
- strength ↑ → 수익률 ↑ (양의 상관관계)

---

## E006: 실제 주가 데이터 백테스트

### 목적
- 한국 주식 실데이터로 전체 시스템 검증
- 실제 트레이딩 가능성 평가

### 대상 종목
- KOSPI 대형주: 삼성전자, SK하이닉스, 현대차
- KOSDAQ: 에코프로비엠, 셀트리온헬스케어
- ETF: KODEX 200, TIGER 반도체

### 테스트 기간
- 학습: 2020-01-01 ~ 2023-12-31 (4년)
- 검증: 2024-01-01 ~ 2024-12-31 (1년)

### 측정 지표
- 연간 수익률
- 최대 낙폭 (MDD)
- 샤프 비율
- 거래 횟수

---

## 실험 환경

```python
# 필수 라이브러리
import pandas as pd
import numpy as np
from core.tradeBT.signal import SignalPredictor, MultiSignalAnalyzer
from core.tradeBT.signal import PriceForecast, TrendAnalyzer  # 예측 (참고용)
from core.tradeBT.advisor import MarketClassifier

# 데이터 소스
# - FinanceDataReader (한국 주식)
# - yfinance (미국 주식, 검증용)
```

## 실험 규칙

1. 모든 실험은 재현 가능해야 함 (seed 고정)
2. 결과는 코드 상단 docstring에 요약
3. 유의미한 발견은 SignalPredictor 개선에 반영
4. **예측은 참고치**: 신호가 주, 예측은 보조
